<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>手动集成参考 | ReSukiSU</title>
    <meta name="description" content="让SukiSU再次伟大！">
    <meta name="generator" content="VitePress v2.0.0-alpha.16">
    <link rel="preload stylesheet" href="/assets/style.v4rNsJRG.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.B9yKTFMQ.js"></script>
    <link rel="modulepreload" href="/assets/chunks/theme.BSP2SI97.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CEw9AoTv.js">
    <link rel="modulepreload" href="/assets/zh-Hans_guide_manual-integrate.md.Cc1nZz4h.lean.js">
    <link rel="icon" href="/favicon.svg">
    <link rel="preconnect" href="https://s4.zstatic.net/">
    <link rel="stylesheet" href="https://s4.zstatic.net/npm/jetbrains-mono-webfont@latest/jetbrains-mono.css">
    <meta name="google-site-verification" content="PFExExHEiCGSrImS-yWoSnddXHrVHFmejD_kcS1g6AY">
    <meta name="robots" content="index, follow">
    <meta name="keywords" content="ReSukiSU, SukiSU, Android, Documentation, Root, Custom ROM, Kernel">
    <meta name="author" content="ReSukiSU Development">
    <meta property="og:title" content="ReSukiSU Documentation">
    <meta property="og:description" content="Make SukiSU Great Again! The official documentation.">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="ReSukiSU">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <script>const load=()=>{import("/pagefind/pagefind.js").then(e=>{window.__pagefind__=e,e.init()}).catch(()=>{})};window.requestIdleCallback?window.requestIdleCallback(load):setTimeout(load,0);</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-29f0b0ce><!--[--><!--[--><!--]--><!--]--><!--[--><span tabindex="-1" data-v-1c725da8></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-1c725da8>Skip to content</a><!--]--><!----><header class="VPNav" data-v-29f0b0ce data-v-94e6f758><div class="VPNavBar has-sidebar top" data-v-94e6f758 data-v-ed681e93><div class="wrapper" data-v-ed681e93><div class="container" data-v-ed681e93><div class="title" data-v-ed681e93><div class="VPNavBarTitle has-sidebar" data-v-ed681e93 data-v-0e5a7ea0><a class="title" href="/zh-Hans/" data-v-0e5a7ea0><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo-mini.svg" alt data-v-00c553fe><!--]--><span data-v-0e5a7ea0>ReSukiSU</span><!--[--><!--]--></a></div></div><div class="content" data-v-ed681e93><div class="content-body" data-v-ed681e93><!--[--><!--]--><div class="blog-search search" data-pagefind-ignore="all" data-v-ed681e93 data-v-30632472><div class="nav-search-btn-wait" data-v-30632472><span data-v-30632472><svg width="14" height="14" viewBox="0 0 20 20" data-v-30632472><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" data-v-30632472></path></svg></span><span class="search-tip" data-v-30632472>Search</span><span class="metaKey" data-v-30632472> K </span></div><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ed681e93 data-v-d11c747d><span id="main-nav-aria-label" class="visually-hidden" data-v-d11c747d> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh-Hans/" tabindex="0" data-v-d11c747d data-v-ed95bb3b><!--[--><span data-v-ed95bb3b><i class="ri-home-2-fill"></i> 主页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/zh-Hans/guide/install.html" tabindex="0" data-v-d11c747d data-v-ed95bb3b><!--[--><span data-v-ed95bb3b><i class="ri-book-2-fill"></i> 指导</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-d11c747d data-v-8d66361c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-8d66361c><span class="text" data-v-8d66361c><!----><span data-v-8d66361c><i class="ri-links-line"></i> 常用链接</span><span class="vpi-chevron-down text-icon" data-v-8d66361c></span></span></button><div class="menu" data-v-8d66361c><div class="VPMenu" data-v-8d66361c data-v-9b0be733><div class="items" data-v-9b0be733><!--[--><!--[--><div class="VPMenuLink" data-v-9b0be733 data-v-33155018><a class="VPLink link vp-external-link-icon" href="https://kernelsu.org/" target="_blank" rel="noreferrer" data-v-33155018><!--[--><span data-v-33155018>KernelSU 文档</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-9b0be733 data-v-33155018><a class="VPLink link vp-external-link-icon" href="https://modules.kernelsu.org/" target="_blank" rel="noreferrer" data-v-33155018><!--[--><span data-v-33155018>KernelSU 模块仓库</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-ed681e93 data-v-450eb4fd data-v-8d66361c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="切换语言" data-v-8d66361c><span class="text" data-v-8d66361c><span class="vpi-languages option-icon" data-v-8d66361c></span><!----><span class="vpi-chevron-down text-icon" data-v-8d66361c></span></span></button><div class="menu" data-v-8d66361c><div class="VPMenu" data-v-8d66361c data-v-9b0be733><!----><!--[--><!--[--><div class="items" data-v-450eb4fd><p class="title" data-v-450eb4fd>简体中文</p><!--[--><div class="VPMenuLink" data-v-450eb4fd data-v-33155018><a class="VPLink link" href="/guide/manual-integrate.html" lang="en" data-v-33155018><!--[--><span data-v-33155018>English</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-ed681e93 data-v-c1d8f535><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-c1d8f535 data-v-56526ae8 data-v-07de66de><span class="check" data-v-07de66de><span class="icon" data-v-07de66de><!--[--><span class="vpi-sun sun" data-v-56526ae8></span><span class="vpi-moon moon" data-v-56526ae8></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ed681e93 data-v-25d72322 data-v-d47cfabb><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ReSukiSU" aria-label="github" target="_blank" rel="me noopener" data-v-d47cfabb data-v-1245b9df><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://t.me/ReSukiSU" aria-label="telegram" target="_blank" rel="me noopener" data-v-d47cfabb data-v-1245b9df><span class="vpi-social-telegram"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ed681e93 data-v-076c956d data-v-8d66361c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8d66361c><span class="vpi-more-horizontal icon" data-v-8d66361c></span></button><div class="menu" data-v-8d66361c><div class="VPMenu" data-v-8d66361c data-v-9b0be733><!----><!--[--><!--[--><div class="group translations" data-v-076c956d><p class="trans-title" data-v-076c956d>简体中文</p><!--[--><div class="VPMenuLink" data-v-076c956d data-v-33155018><a class="VPLink link" href="/guide/manual-integrate.html" lang="en" data-v-33155018><!--[--><span data-v-33155018>English</span><!--]--></a></div><!--]--></div><div class="group" data-v-076c956d><div class="item appearance" data-v-076c956d><p class="label" data-v-076c956d>外观</p><div class="appearance-action" data-v-076c956d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-076c956d data-v-56526ae8 data-v-07de66de><span class="check" data-v-07de66de><span class="icon" data-v-07de66de><!--[--><span class="vpi-sun sun" data-v-56526ae8></span><span class="vpi-moon moon" data-v-56526ae8></span><!--]--></span></span></button></div></div></div><div class="group" data-v-076c956d><div class="item social-links" data-v-076c956d><div class="VPSocialLinks social-links-list" data-v-076c956d data-v-d47cfabb><!--[--><a class="VPSocialLink no-icon" href="https://github.com/ReSukiSU" aria-label="github" target="_blank" rel="me noopener" data-v-d47cfabb data-v-1245b9df><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://t.me/ReSukiSU" aria-label="telegram" target="_blank" rel="me noopener" data-v-d47cfabb data-v-1245b9df><span class="vpi-social-telegram"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ed681e93 data-v-9f53e0cb><span class="container" data-v-9f53e0cb><span class="top" data-v-9f53e0cb></span><span class="middle" data-v-9f53e0cb></span><span class="bottom" data-v-9f53e0cb></span></span></button></div></div></div></div><div class="divider" data-v-ed681e93><div class="divider-line" data-v-ed681e93></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-29f0b0ce data-v-4759e5d3><div class="container" data-v-4759e5d3><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-4759e5d3><span class="vpi-align-left menu-icon" data-v-4759e5d3></span><span class="menu-text" data-v-4759e5d3>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-4759e5d3 data-v-9d642c80><button data-v-9d642c80>返回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-29f0b0ce data-v-fc1dc920><div class="curtain" data-v-fc1dc920></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-fc1dc920><span class="visually-hidden" id="sidebar-aria-label" data-v-fc1dc920> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-46a469ef><section class="VPSidebarItem level-0 has-active" data-v-46a469ef data-v-9ef782d6><div class="item" role="button" tabindex="0" data-v-9ef782d6><div class="indicator" data-v-9ef782d6></div><h2 class="text" data-v-9ef782d6>开始使用</h2><!----></div><div class="items" data-v-9ef782d6><!--[--><div class="VPSidebarItem level-1 is-link" data-v-9ef782d6 data-v-9ef782d6><div class="item" data-v-9ef782d6><div class="indicator" data-v-9ef782d6></div><a class="VPLink link link" href="/zh-Hans/guide/install.html" data-v-9ef782d6><!--[--><p class="text" data-v-9ef782d6>安装</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed is-link has-active" data-v-9ef782d6 data-v-9ef782d6><div class="item" tabindex="0" data-v-9ef782d6><div class="indicator" data-v-9ef782d6></div><a class="VPLink link link" href="/zh-Hans/guide/build.html" data-v-9ef782d6><!--[--><h3 class="text" data-v-9ef782d6>构建内核</h3><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-9ef782d6><span class="vpi-chevron-right caret-icon" data-v-9ef782d6></span></div></div><div class="items" data-v-9ef782d6><!--[--><div class="VPSidebarItem level-2 is-link" data-v-9ef782d6 data-v-9ef782d6><div class="item" data-v-9ef782d6><div class="indicator" data-v-9ef782d6></div><a class="VPLink link link" href="/zh-Hans/guide/manual-integrate.html" data-v-9ef782d6><!--[--><p class="text" data-v-9ef782d6>参考钩子</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-9ef782d6 data-v-9ef782d6><div class="item" data-v-9ef782d6><div class="indicator" data-v-9ef782d6></div><a class="VPLink link link" href="/zh-Hans/guide/faq.html" data-v-9ef782d6><!--[--><p class="text" data-v-9ef782d6>常见问题</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-46a469ef><section class="VPSidebarItem level-0" data-v-46a469ef data-v-9ef782d6><!----><div class="items" data-v-9ef782d6><!--[--><div class="VPSidebarItem level-1 is-link" data-v-9ef782d6 data-v-9ef782d6><div class="item" data-v-9ef782d6><div class="indicator" data-v-9ef782d6></div><a class="VPLink link link" href="/zh-Hans/guide/introduce.html" data-v-9ef782d6><!--[--><p class="text" data-v-9ef782d6>关于 ReSukiSU</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-29f0b0ce data-v-52c824fd><div class="VPDoc has-sidebar has-aside" data-v-52c824fd data-v-77cabbb2><!--[--><!--]--><div class="container" data-v-77cabbb2><div class="aside" data-v-77cabbb2><div class="aside-curtain" data-v-77cabbb2></div><div class="aside-container" data-v-77cabbb2><div class="aside-content" data-v-77cabbb2><div class="VPDocAside" data-v-77cabbb2 data-v-4579367d><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-4579367d data-v-a64ad6cd><div class="content" data-v-a64ad6cd><div class="outline-marker" data-v-a64ad6cd></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a64ad6cd>本页目录</div><ul class="VPDocOutlineItem root" data-v-a64ad6cd data-v-02e703fa><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-4579367d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-77cabbb2><div class="content-container" data-v-77cabbb2><!--[--><!--]--><main class="main" data-v-77cabbb2><div style="position:relative;" class="vp-doc _zh-Hans_guide_manual-integrate external-link-icon-enabled" data-v-77cabbb2><div data-pagefind-body="true" data-pagefind-meta="date:1772251583000"><div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /zh-Hans/guide/manual-integrate.md for this page in Markdown format</div><h1 id="hooks" tabindex="-1">手动集成参考 <a class="header-anchor" href="#hooks" aria-label="Permalink to “手动集成参考”">​</a></h1><div class="markdown-copy-buttons" data-v-d484e26c><div class="markdown-copy-buttons-inner" data-v-d484e26c><div class="dropdown-container" data-v-d484e26c><div class="dropdown-trigger" data-v-d484e26c><button class="copy-page" data-v-d484e26c><span class="icon" data-v-d484e26c><svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg></span><span class="label" data-v-d484e26c>Copy page</span></button><span class="divider" data-v-d484e26c></span><button class="chevron-wrapper" data-v-d484e26c><span class="icon chevron" data-v-d484e26c><svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-chevron-down-icon lucide-chevron-down" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg></span></button></div><!----></div><button class="download-btn" data-v-d484e26c><span class="icon" data-v-d484e26c><svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-file-down-icon lucide-file-down" viewBox="0 0 24 24"><path d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"/><path d="M14 2v5a1 1 0 0 0 1 1h5m-8 10v-6m-3 3 3 3 3-3"/></svg></span></button></div></div><h2 id="scope-minimized-hooks" tabindex="-1">手动挂钩 <a class="header-anchor" href="#scope-minimized-hooks" aria-label="Permalink to “手动挂钩”">​</a></h2><div class="danger custom-block"><p class="custom-block-title">Notice：</p><p>ReSukiSU 将会检查此处每一条 hook，如果缺少，将会<strong>导致编译失败</strong></p></div><div class="info custom-block"><p class="custom-block-title">提示</p><p>这一部分的钩子，改编于 <a class="VPNolebaseInlinePreviewLink" relative href="https://github.com/backslashxx/KernelSU/issues/5" target="_blank" rel="noreferrer" data-v-cc2a96b7><!--[--><code>backslashxx/KernelSU #5</code><!--]--><!----></a></p></div><h3 id="generic-hooks" tabindex="-1">通用钩子 <span class="VPBadge danger"><!--[-->必加<!--]--></span> <a class="header-anchor" href="#generic-hooks" aria-label="Permalink to “通用钩子”">​</a></h3><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-21" id="tab-22" checked><label data-title="exec.c" for="tab-22">exec.c</label><input type="radio" name="group-21" id="tab-23"><label data-title="stat.c" for="tab-23">stat.c</label></div><div class="blocks"><div class="language-diff active"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/fs/exec.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/fs/exec.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -1886,12 +1886,26 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> static int do_execveat_common(int fd, struct filename *filename,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	return retval;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+__attribute__((hot))</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern int ksu_handle_execveat(int *fd, struct filename **filename_ptr,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+				void *argv, void *envp, int *flags);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> int do_execve(struct filename *filename,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	const char __user *const __user *__argv,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	const char __user *const __user *__envp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	struct user_arg_ptr argv = { .ptr.native = __argv };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	struct user_arg_ptr envp = { .ptr.native = __envp };</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	ksu_handle_execveat((int *)AT_FDCWD, &amp;filename, &amp;argv, &amp;envp, 0);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	return do_execveat_common(AT_FDCWD, filename, argv, envp, 0);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -1919,6 +1933,10 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> static int compat_do_execve(struct filename *filename,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		.is_compat = true,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		.ptr.compat = __envp,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	};</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK // 32-bit ksud and 32-on-64 support</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	ksu_handle_execveat((int *)AT_FDCWD, &amp;filename, &amp;argv, &amp;envp, 0);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	return do_execveat_common(AT_FDCWD, filename, argv, envp, 0);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/fs/stat.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/fs/stat.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -353,6 +353,10 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE2(newlstat, const char __user *, filename,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	return cp_new_stat(&amp;stat, statbuf);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+__attribute__((hot)) </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern int ksu_handle_stat(int *dfd, const char __user **filename_user,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+				int *flags);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern void ksu_handle_newfstat_ret(unsigned int *fd, struct stat __user **statbuf_ptr);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#if defined(__ARCH_WANT_STAT64) || defined(__ARCH_WANT_COMPAT_STAT64)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern void ksu_handle_fstat64_ret(unsigned long *fd, struct stat64 __user **statbuf_ptr); // optional</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> #if !defined(__ARCH_WANT_STAT64) || defined(__ARCH_WANT_SYS_NEWFSTATAT)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE4(newfstatat, int, dfd, const char __user *, filename,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		struct stat __user *, statbuf, int, flag)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -360,6 +364,9 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE4(newfstatat, int, dfd, const char __user *, filename,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	struct kstat stat;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	int error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	ksu_handle_stat(&amp;dfd, &amp;filename, &amp;flag);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	error = vfs_fstatat(dfd, filename, &amp;stat, flag);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	if (error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		return error;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -504,6 +511,9 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE4(fstatat64, int, dfd, const char __user *, filename,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	struct kstat stat;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	int error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK // 32-bit su</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	ksu_handle_stat(&amp;dfd, &amp;filename, &amp;flag); </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	error = vfs_fstatat(dfd, filename, &amp;stat, flag);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	if (error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		return error;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -364,X +364,XX @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SYSCALL_DEFINE2(newfstat, unsigned int, fd, struct stat __user *, statbuf)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	struct kstat stat;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	int error = vfs_fstat(fd, &amp;stat);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	if (!error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		error = cp_new_stat(&amp;stat, statbuf);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	ksu_handle_newfstat_ret(&amp;fd, &amp;statbuf);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	return error;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -490,X +497,X @@</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SYSCALL_DEFINE2(fstat64, unsigned long, fd, struct stat64 __user *, statbuf)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	struct kstat stat;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	int error = vfs_fstat(fd, &amp;stat);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	if (!error)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		error = cp_new_stat64(&amp;stat, statbuf);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK // for 32-bit</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	ksu_handle_fstat64_ret(&amp;fd, &amp;statbuf);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	return error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div><h3 id="faccessat-hook" tabindex="-1">faccessat hook <span class="VPBadge danger"><!--[-->必加<!--]--></span> <a class="header-anchor" href="#faccessat-hook" aria-label="Permalink to “faccessat hook”">​</a></h3><p>对于此 hook，不同版本内核不一致，此处单独说明</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-31" id="tab-32" checked><label data-title="4.19+" for="tab-32">4.19+</label><input type="radio" name="group-31" id="tab-33"><label data-title="4.19-" for="tab-33">4.19-</label></div><div class="blocks"><div class="language-diff active"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/fs/open.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/fs/open.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -450,8 +450,16 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> long do_faccessat(int dfd, const char __user *filename, int mode)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	return res;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+__attribute__((hot)) </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern int ksu_handle_faccessat(int *dfd, const char __user **filename_user,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+				int *mode, int *flags);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE3(faccessat, int, dfd, const char __user *, filename, int, mode)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	ksu_handle_faccessat(&amp;dfd, &amp;filename, &amp;mode, NULL);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	return do_faccessat(dfd, filename, mode);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/fs/open.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/fs/open.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -354,6 +354,11 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE4(fallocate, int, fd, int, mode, loff_t, offset, loff_t, len)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	return error;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+__attribute__((hot)) </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern int ksu_handle_faccessat(int *dfd, const char __user **filename_user,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+				int *mode, int *flags);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * access() needs to use the real uid/gid, not the effective uid/gid.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * We do this by temporarily clearing all FS-related capabilities and</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -369,6 +374,10 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE3(faccessat, int, dfd, const char __user *, filename, int, mode)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	int res;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	unsigned int lookup_flags = LOOKUP_FOLLOW;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	ksu_handle_faccessat(&amp;dfd, &amp;filename, &amp;mode, NULL);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	if (mode &amp; ~S_IRWXO)	/* where&#39;s F_OK, X_OK, W_OK, R_OK? */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		return -EINVAL;</span></span></code></pre></div></div></div><h3 id="sys-reboot-hook" tabindex="-1">sys_reboot hook <span class="VPBadge danger"><!--[-->必加<!--]--></span> <a class="header-anchor" href="#sys-reboot-hook" aria-label="Permalink to “sys_reboot hook”">​</a></h3><p>对于此 hook，不同版本内核不一致，此处单独说明</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-41" id="tab-42" checked><label data-title="3.11+" for="tab-42">3.11+</label><input type="radio" name="group-41" id="tab-43"><label data-title="3.11-" for="tab-43">3.11-</label></div><div class="blocks"><div class="language-diff active"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/kernel/reboot.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/kernel/reboot.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -277,6 +277,11 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> static DEFINE_MUTEX(reboot_mutex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  *</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * reboot doesn&#39;t sync: do that yourself before calling this.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  */</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern int ksu_handle_sys_reboot(int magic1, int magic2, unsigned int cmd, void __user **arg);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE4(reboot, int, magic1, int, magic2, unsigned int, cmd,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		void __user *, arg)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -284,6 +289,9 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE4(reboot, int, magic1, int, magic2, unsigned int, cmd,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	char buffer[256];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	int ret = 0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	ksu_handle_sys_reboot(magic1, magic2, cmd, &amp;arg);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	/* We only trust the superuser with rebooting the system. */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	if (!ns_capable(pid_ns-&gt;user_ns, CAP_SYS_BOOT))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		return -EPERM;</span></span></code></pre></div><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">diff --git a/kernel/sys.c b/kernel/sys.c</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index a3bef5bd..08d196f5 100644</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/kernel/sys.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/kernel/sys.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -455,6 +455,10 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EXPORT_SYMBOL_GPL(kernel_power_off);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> static DEFINE_MUTEX(reboot_mutex);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern int ksu_handle_sys_reboot(int magic1, int magic2, unsigned int cmd, void __user **arg);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * Reboot system call: for obvious reasons only root may call it,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * and even root needs to set up some magic numbers in the registers</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -470,6 +474,10 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE4(reboot, int, magic1, int, magic2, unsigned int, cmd,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        char buffer[256];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        int ret = 0;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+       ksu_handle_sys_reboot(magic1, magic2, cmd, &amp;arg);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        /* We only trust the superuser with rebooting the system. */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        if (!ns_capable(pid_ns-&gt;user_ns, CAP_SYS_BOOT))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                return -EPERM;</span></span></code></pre></div></div></div><h3 id="input-hooks" tabindex="-1">input hooks <span class="VPBadge tip"><!--[-->按需必加<!--]--></span> <a class="header-anchor" href="#input-hooks" aria-label="Permalink to “input hooks”">​</a></h3><div class="warning custom-block"><p class="custom-block-title">一般无需此手动 hook</p><p>对于 input handler 未损坏的内核，只需保证 <code>CONFIG_KSU_MANUAL_HOOK_AUTO_INPUT_HOOK</code> 处于启用状态，此 hook 即可通过 input_hanlder 自动应用</p></div><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-53" id="tab-54" checked><label data-title="input.c" for="tab-54">input.c</label></div><div class="blocks"><div class="language-diff active"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/drivers/input/input.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/drivers/input/input.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -436,11 +436,22 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> static void input_handle_event(struct input_dev *dev,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * to &#39;seed&#39; initial state of a switch or initial position of absolute</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * axis, etc.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  */</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern bool ksu_input_hook __read_mostly;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern __attribute__((cold)) int ksu_handle_input_handle_event(</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+			unsigned int *type, unsigned int *code, int *value);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> void input_event(struct input_dev *dev,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		 unsigned int type, unsigned int code, int value)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	unsigned long flags;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	if (unlikely(ksu_input_hook))</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+		ksu_handle_input_handle_event(&amp;type, &amp;code, &amp;value);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	if (is_event_supported(type, dev-&gt;evbit, EV_MAX)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		spin_lock_irqsave(&amp;dev-&gt;event_lock, flags);</span></span></code></pre></div></div></div><h3 id="setuid-hooks" tabindex="-1">setuid hooks <span class="VPBadge warning"><!--[-->6.8+ 必加<!--]--></span> <span class="VPBadge warning"><!--[-->4.2- 必加<!--]--></span> <a class="header-anchor" href="#setuid-hooks" aria-label="Permalink to “setuid hooks”">​</a></h3><div class="warning custom-block"><p class="custom-block-title">大部分版本不需要此手动 hook</p><p>对于 4.2~6.8 (不包括 6.8) 的内核，只需保证 <code>CONFIG_KSU_MANUAL_HOOK_AUTO_SETUID_HOOK</code> 处于启用状态，此 hook 即可通过 LSM 自动应用</p></div><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-64" id="tab-65" checked><label data-title="4.17+" for="tab-65">4.17+</label><input type="radio" name="group-64" id="tab-66"><label data-title="4.17-" for="tab-66">4.17-</label></div><div class="blocks"><div class="language-diff active"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">diff --git a/kernel/sys.c b/kernel/sys.c</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index 4a87dc5fa..aac25df8c 100644</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/kernel/sys.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/kernel/sys.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -679,6 +679,10 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE1(setuid, uid_t, uid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern int ksu_handle_setresuid(uid_t ruid, uid_t euid, uid_t suid);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * This function implements a generic ability to update ruid, euid,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * and suid.  This allows you to implement the 4.4 compatible seteuid().</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -692,6 +696,10 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> long __sys_setresuid(uid_t ruid, uid_t euid, uid_t suid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        kuid_t kruid, keuid, ksuid;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        bool ruid_new, euid_new, suid_new;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+       (void)ksu_handle_setresuid(ruid, euid, suid);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        kruid = make_kuid(ns, ruid);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        keuid = make_kuid(ns, euid);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ksuid = make_kuid(ns, suid);</span></span></code></pre></div><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">diff --git a/kernel/sys.c b/kernel/sys.c</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index a3bef5bd..0b116d7c 100644</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/kernel/sys.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/kernel/sys.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -835,6 +843,9 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> error:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        return retval;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern int ksu_handle_setresuid(uid_t ruid, uid_t euid, uid_t suid);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * This function implements a generic ability to update ruid, euid,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -848,6 +859,10 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE3(setresuid, uid_t, ruid, uid_t, euid, uid_t, suid)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        int retval;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        kuid_t kruid, keuid, ksuid;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+       (void)ksu_handle_setresuid(ruid, euid, suid);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        kruid = make_kuid(ns, ruid);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        keuid = make_kuid(ns, euid);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ksuid = make_kuid(ns, suid);</span></span></code></pre></div></div></div><h3 id="sys-read-hook" tabindex="-1">sys_read hook <span class="VPBadge warning"><!--[-->6.8+ 必加<!--]--></span> <span class="VPBadge warning"><!--[-->4.2- 必加<!--]--></span> <a class="header-anchor" href="#sys-read-hook" aria-label="Permalink to “sys_read hook”">​</a></h3><div class="warning custom-block"><p class="custom-block-title">大部分版本不需要此手动 hook</p><p>对于 4.2~6.8 (不包括 6.8) 的内核，只需保证 <code>CONFIG_KSU_MANUAL_HOOK_AUTO_INITRC_HOOK</code> 处于启用状态，此 hook 即可通过 LSM 自动应用</p></div><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-76" id="tab-77" checked><label data-title="4.19+" for="tab-77">4.19+</label><input type="radio" name="group-76" id="tab-78"><label data-title="4.19-" for="tab-78">4.19-</label></div><div class="blocks"><div class="language-diff active"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/fs/read_write.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/fs/read_write.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -586,8 +586,18 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ssize_t ksys_read(unsigned int fd, char __user *buf, size_t count)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	return ret;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern bool ksu_init_rc_hook __read_mostly;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern __attribute__((cold)) int ksu_handle_sys_read(unsigned int fd,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+				char __user **buf_ptr, size_t *count_ptr);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE3(read, unsigned int, fd, char __user *, buf, size_t, count)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	if (unlikely(ksu_init_rc_hook)) </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+		ksu_handle_sys_read(fd, &amp;buf, &amp;count);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	return ksys_read(fd, buf, count);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/fs/read_write.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/fs/read_write.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -568,11 +568,21 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> static inline void file_pos_write(struct file *file, loff_t pos)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		file-&gt;f_pos = pos;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern bool ksu_init_rc_hook __read_mostly;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+extern __attribute__((cold)) int ksu_handle_sys_read(unsigned int fd,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+				char __user **buf_ptr, size_t *count_ptr);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SYSCALL_DEFINE3(read, unsigned int, fd, char __user *, buf, size_t, count)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	struct fd f = fdget_pos(fd);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	ssize_t ret = -EBADF;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#ifdef CONFIG_KSU_MANUAL_HOOK</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	if (unlikely(ksu_init_rc_hook)) </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+		ksu_handle_sys_read(fd, &amp;buf, &amp;count);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 	if (f.file) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		loff_t pos = file_pos_read(f.file);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 		ret = vfs_read(f.file, buf, count, &amp;pos);</span></span></code></pre></div></div></div><h2 id="how-to-backport-path-umount" tabindex="-1">path_umount <span class="VPBadge info"><!--[-->可选<!--]--></span> <a class="header-anchor" href="#how-to-backport-path-umount" aria-label="Permalink to “path_umount”">​</a></h2><div class="info custom-block"><p class="custom-block-title">Notes</p><p>这是一个可选选项，你可以不移植这一部分</p></div><p>你可以通过从 K5.9 向旧版本移植 <code>path_umount</code>，在 GKI 之前的内核上获得卸载模块的功能。你可以通过以下补丁作为参考:</p><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">--- a/fs/namespace.c</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+++ b/fs/namespace.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-light-font-weight:bold;--shiki-dark:#B392F0;--shiki-dark-font-weight:bold;">@@ -1739,6 +1739,39 @@</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> static inline bool may_mandlock(void)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> #endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+static int can_umount(const struct path *path, int flags)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+{</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	struct mount *mnt = real_mount(path-&gt;mnt);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	if (flags &amp; ~(MNT_FORCE | MNT_DETACH | MNT_EXPIRE | UMOUNT_NOFOLLOW))</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+		return -EINVAL;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	if (!may_mount())</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+		return -EPERM;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	if (path-&gt;dentry != path-&gt;mnt-&gt;mnt_root)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+		return -EINVAL;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	if (!check_mnt(mnt))</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+		return -EINVAL;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	if (mnt-&gt;mnt.mnt_flags &amp; MNT_LOCKED) /* Check optimistically */</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+		return -EINVAL;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	if (flags &amp; MNT_FORCE &amp;&amp; !capable(CAP_SYS_ADMIN))</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+		return -EPERM;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	return 0;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+}</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+int path_umount(struct path *path, int flags)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+{</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	struct mount *mnt = real_mount(path-&gt;mnt);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	int ret;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	ret = can_umount(path, flags);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	if (!ret)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+		ret = do_umount(mnt, flags);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	/* we mustn&#39;t call path_put() as that would clear mnt_expiry_mark */</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	dput(path-&gt;dentry);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	mntput_no_expire(mnt);</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+	return ret;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /*</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * Now umount can handle mount points as well as block devices.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  * This is important for filesystems which use unnamed block devices.</span></span></code></pre></div><!--[--><h2 id="页面历史" data-v-5f669d8d>页面历史 <a class="header-anchor" href="#页面历史" aria-label="Permalink to &#39;页面历史&#39;" data-v-5f669d8d></a></h2><div class="bg-$vp-custom-block-details-bg vp-nolebase-git-changelog vp-nolebase-git-changelog-history vp-nolebase-git-changelog-history-list vp-nolebase-git-changelog-history-container" rounded-lg p-4 data-v-5f669d8d><label cursor-pointer data-v-5f669d8d><div class="vp-nolebase-git-changelog-title flex select-none items-center justify-between" transition="color ease-in-out" text="&lt;sm:xs" duration-200 data-v-5f669d8d><span class="vp-nolebase-git-changelog-last-edited-title inline-flex items-center gap-3" data-v-5f669d8d><div class="i-octicon:history-16" data-v-5f669d8d></div><span data-v-5f669d8d>最后编辑于 1 天前</span></span><div class="i-octicon:sort-desc-16" ml-auto mr-4 cursor-pointer data-v-5f669d8d></div><span class="vp-nolebase-git-changelog-view-full-history-title inline-flex cursor-pointer items-center gap-3" data-v-5f669d8d><span class="&lt;sm:hidden" data-v-5f669d8d>查看完整历史</span><svg class="rotate-0 i-octicon:chevron-down-16" transition="transform ease-in-out" duration-200 data-v-5f669d8d></svg></span></div></label><div class="grid grid-cols-[30px_auto] mt-3 gap-1.5 children:my-auto -ml-1.5" text="&lt;sm:xs" style="display:none;" data-v-5f669d8d><!--[--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/523386ba65f65d894e49e74731ac76b3d6025c91" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>523386b</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs: update LSM notice</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/0b3654cbc82b05b5eb6d02ac694159d97522304a" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>0b3654c</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs: update manual hook</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/45e4f1dc8d003f7251609398f548e2e2d13c0e8f" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>45e4f1d</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs: deprecated is_ksu_transition</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/dd433ac65e828914226a454ffea2d72f7463faad" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>dd433ac</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs: manual: add badges to be noticeable.</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/f3925cb90e9545b07a6002355d55189215af73d5" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>f3925cb</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs: adapt latest scope-minimized-hook</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/a70cc6e4eb25f157885b155189f6d74481f474fe" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>a70cc6e</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>rename to ksu_init_rc_hook for zh</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/5d5595338867f58ea2564ce232a532bb293c8d05" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>5d55953</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs: fix dead link also rename manual hook for zh-hans</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/bfd76bce0f13e616ab147e6005f528403bc72a7e" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>bfd76bc</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs: remove ksu official hook, rename manual-hook -&gt; manual-integrate</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/1f138c8098f6a0c94a0c7823a1842d9570388665" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>1f138c8</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>refine</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/b091e9df87eb7654dab7de326c128374571a9337" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>b091e9d</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs(manual): add <code>#link</code></span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/631f5319fe88527492289e72e304677e0cde181a" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>631f531</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>fix</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/f5c2b2efd05504800ca29e1a14bdc01db4cfead4" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>f5c2b2e</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>doc: adapt newfsstat_ret hook with latest builtin kernel change</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/104b66800da0109eae8b81969e4638cf18668dd9" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>104b668</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs: add newfstat ret_hook</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/754be284dd17c8c874c008e83700fdfd7458b6ff" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>754be28</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs: rename ksu_vfs_read_hook to ksu_sys_read_hook</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/222947df7dee319c76bc556a44f08718bc88cca1" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>222947d</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>update zh manual_hook doc for input_handler auto input hook</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/be1aceb6b0592eac0d453a20f2c88981568c0941" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>be1aceb</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>docs: adjust style</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/cfb810a4b435f06e76fe0629b025686ecd3df61b" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>cfb810a</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>manual_hook: zh/en</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/6e33188e20faee8865b0a96e725e41d73df31fec" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>6e33188</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>feat: add setresuid hooks</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/4b736dec4f9be5f1b86f5bd00958c2ac5daab3b4" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>4b736de</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>document(2/?)</span><!----><!----></span></div><!--]--><!--]--><!--[--><!--[--><div class="i-octicon:git-commit-16 m-auto rotate-90 transform op-30" data-v-a7c6e310></div><div flex gap-1 align-baseline data-v-a7c6e310><a href="https://github.com/ReSukiSU/ReSukiSU.github.io/commit/84a4927e34bdd14197d19a3610affdf78bd42acb" target="_blank" class="no-icon" data-v-a7c6e310><code class="text-xs text-$vp-c-brand-1 hover:text-$vp-c-brand-1" transition="color ease-in-out" duration-200 data-v-a7c6e310>84a4927</code></a><span data-v-a7c6e310>-</span><span data-v-a7c6e310><span class="text-sm &lt;sm:text-xs" data-v-a7c6e310>add documents(1/?)</span><!----><!----></span></div><!--]--><!--]--><!--]--></div></div><!--]--></div></div></main><footer class="VPDocFooter" data-v-77cabbb2 data-v-09413b6a><!--[--><!--]--><div class="edit-info" data-v-09413b6a><div class="edit-link" data-v-09413b6a><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/ReSukiSU/ReSukiSU.github.io/edit/main/docs/zh-Hans/guide/manual-integrate.md" target="_blank" rel="noreferrer" data-v-09413b6a><!--[--><span class="vpi-square-pen edit-link-icon" data-v-09413b6a></span> 在 Github 上编辑此页面<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-09413b6a><span class="visually-hidden" id="doc-footer-aria-label" data-v-09413b6a>Pager</span><div class="pager" data-v-09413b6a><a class="VPLink link pager-link prev" href="/zh-Hans/guide/build.html" data-v-09413b6a><!--[--><span class="desc" data-v-09413b6a>上一页</span><span class="title" data-v-09413b6a>构建内核</span><!--]--></a></div><div class="pager" data-v-09413b6a><a class="VPLink link pager-link next" href="/zh-Hans/guide/faq.html" data-v-09413b6a><!--[--><span class="desc" data-v-09413b6a>下一页</span><span class="title" data-v-09413b6a>常见问题</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-29f0b0ce data-v-b7f4d81a><div class="container" data-v-b7f4d81a><p class="message" data-v-b7f4d81a>Documented with by ReSukiSU Development</p><p class="copyright" data-v-b7f4d81a>Copyright © 2025-2026 ReSukiSU, under MIT License</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"guide_build.md\":\"XjnIf_q4\",\"guide_faq.md\":\"CSnBa7XN\",\"guide_install.md\":\"BtqRQZNd\",\"guide_introduce.md\":\"CgVv22xj\",\"guide_manual-integrate.md\":\"D4Q4GHUD\",\"index.md\":\"Frx6PhXd\",\"zh-hans_guide_build.md\":\"ChOIfJla\",\"zh-hans_guide_faq.md\":\"CyTEhXS1\",\"zh-hans_guide_install.md\":\"CdTyiibL\",\"zh-hans_guide_introduce.md\":\"CBAhoG50\",\"zh-hans_guide_manual-integrate.md\":\"Cc1nZz4h\",\"zh-hans_index.md\":\"Bn3BR5mO\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"ReSukiSU\",\"description\":\"Make SukiSU Great Again!\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo-mini.svg\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/ReSukiSU\"},{\"icon\":\"telegram\",\"link\":\"https://t.me/ReSukiSU\"}],\"footer\":{\"message\":\"Documented with by ReSukiSU Development\",\"copyright\":\"Copyright © 2025-2026 ReSukiSU, under MIT License\"},\"outline\":{\"level\":[2,4]},\"externalLinkIcon\":true},\"locales\":{\"root\":{\"label\":\"English\",\"lang\":\"en\",\"themeConfig\":{\"nav\":[{\"text\":\"<i class=\\\"ri-home-2-fill\\\"></i> Home\",\"link\":\"/\"},{\"text\":\"<i class=\\\"ri-book-2-fill\\\"></i> Guide\",\"link\":\"/guide/install\"},{\"text\":\"<i class=\\\"ri-links-line\\\"></i> Links\",\"items\":[{\"text\":\"KernelSU Documentation\",\"link\":\"https://kernelsu.org/\"},{\"text\":\"KernelSU Modules Repository\",\"link\":\"https://modules.kernelsu.org/\"}]}],\"sidebar\":[{\"text\":\"Get started\",\"items\":[{\"text\":\"Install\",\"link\":\"/guide/install\"},{\"text\":\"Building Kernel\",\"link\":\"/guide/build\",\"collapsed\":true,\"items\":[{\"text\":\"Manual Hooks\",\"link\":\"/guide/manual-integrate\"}]},{\"text\":\"FAQ\",\"link\":\"/guide/faq\"}]},{\"text\":\"About ReSukiSU\",\"link\":\"/guide/introduce\"}],\"editLink\":{\"text\":\"Edit page on Github\",\"pattern\":\"https://github.com/ReSukiSU/ReSukiSU.github.io/edit/main/docs/:path\"},\"docFooter\":{\"prev\":\"Previous page\",\"next\":\"Next page\"},\"lastUpdated\":{\"text\":\"Last updated\"},\"returnToTopLabel\":\"Return to top\",\"sidebarMenuLabel\":\"Menu\",\"darkModeSwitchLabel\":\"Appearance\",\"langMenuLabel\":\"Change language\"},\"description\":\"Make SukiSU Great Again!\"},\"zh-Hans\":{\"label\":\"简体中文\",\"lang\":\"zh-CN\",\"themeConfig\":{\"nav\":[{\"text\":\"<i class=\\\"ri-home-2-fill\\\"></i> 主页\",\"link\":\"/zh-Hans/\"},{\"text\":\"<i class=\\\"ri-book-2-fill\\\"></i> 指导\",\"link\":\"/zh-Hans/guide/install\"},{\"text\":\"<i class=\\\"ri-links-line\\\"></i> 常用链接\",\"items\":[{\"text\":\"KernelSU 文档\",\"link\":\"https://kernelsu.org/\"},{\"text\":\"KernelSU 模块仓库\",\"link\":\"https://modules.kernelsu.org/\"}]}],\"sidebar\":[{\"text\":\"开始使用\",\"items\":[{\"text\":\"安装\",\"link\":\"/zh-Hans/guide/install\"},{\"text\":\"构建内核\",\"link\":\"/zh-Hans/guide/build\",\"collapsed\":true,\"items\":[{\"text\":\"参考钩子\",\"link\":\"/zh-Hans/guide/manual-integrate\"}]},{\"text\":\"常见问题\",\"link\":\"/zh-Hans/guide/faq\"}]},{\"text\":\"关于 ReSukiSU\",\"link\":\"/zh-Hans/guide/introduce\"}],\"editLink\":{\"text\":\"在 Github 上编辑此页面\",\"pattern\":\"https://github.com/ReSukiSU/ReSukiSU.github.io/edit/main/docs/:path\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"lastUpdated\":{\"text\":\"最后更新于\"},\"returnToTopLabel\":\"返回顶部\",\"sidebarMenuLabel\":\"菜单\",\"darkModeSwitchLabel\":\"外观\",\"langMenuLabel\":\"切换语言\",\"outline\":{\"label\":\"本页目录\"}},\"description\":\"让SukiSU再次伟大！\"}},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>