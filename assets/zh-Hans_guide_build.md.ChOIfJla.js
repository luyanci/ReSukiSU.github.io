import{_ as k,I as l,o as h,c as p,j as i,a,J as e,w as n,ab as d}from"./chunks/framework.CEw9AoTv.js";const C=JSON.parse('{"title":"如何为内核集成 ReSukiSU","description":"","frontmatter":{},"headers":[],"relativePath":"zh-Hans/guide/build.md","filePath":"zh-Hans/guide/build.md"}'),g={name:"zh-Hans/guide/build.md"},u={class:"info custom-block"};function c(f,s,b,F,m,y){const o=l("CopyOrDownloadAsMarkdownButtons"),t=l("VPNolebaseInlineLinkPreview"),r=l("NolebaseGitChangelog");return h(),p("div",{"data-pagefind-body":!0,"data-pagefind-meta":"date:1771295867000"},[s[20]||(s[20]=i("div",{style:{display:"none"},hidden:"true","aria-hidden":"true"},"Are you an LLM? You can read better optimized documentation at /zh-Hans/guide/build.md for this page in Markdown format",-1)),s[21]||(s[21]=i("h1",{id:"introduction",tabindex:"-1"},[a("如何为内核集成 ReSukiSU "),i("a",{class:"header-anchor",href:"#introduction","aria-label":"Permalink to “如何为内核集成 ReSukiSU”"},"​")],-1)),e(o),i("div",u,[s[2]||(s[2]=i("p",{class:"custom-block-title"},"Notes",-1)),i("p",null,[s[1]||(s[1]=a("这个文档修改自 ",-1)),e(t,{href:"https://kernelsu.org",target:"_blank",rel:"noreferrer"},{default:n(()=>[...s[0]||(s[0]=[a("KernelSU 官方文档",-1)])]),_:1})])]),s[22]||(s[22]=d(`<p>ReSukiSU 可以被集成到 GKI / 非 GKI 内核中，现在它<mark>最低支持到内核 4.9 版本</mark>；理论上也可以支持更低的版本。</p><p>由于非 GKI 内核的碎片化<strong>极其严重</strong>，因此通常没有统一的方法来编译它。但你完全可以自己集成 ReSukiSU 然后编译内核使用。</p><p>首先，你必须有能力从你设备的内核源码编译出一个可以开机并且能正常使用的内核，如果内核不开源，这通常难以做到。</p><p>如果你已经做好了上述准备，可以通过这个教程来集成 ReSukiSU 到你的内核之中。</p><h2 id="构建内核" tabindex="-1">构建内核 <a class="header-anchor" href="#构建内核" aria-label="Permalink to “构建内核”">​</a></h2><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>本部分仅适用于 GKI 设备</p></div><h3 id="同步内核源码" tabindex="-1">同步内核源码 <a class="header-anchor" href="#同步内核源码" aria-label="Permalink to “同步内核源码”">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://android.googlesource.com/kernel/manifest</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kernel_manifest.xm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">l</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .repo/manifests</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> manifest.xml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sync</span></span></code></pre></div>`,8)),i("p",null,[s[4]||(s[4]=i("code",null,"<kernel_manifest.xml>",-1)),s[5]||(s[5]=a(" 是一个可以唯一确定构建的清单文件，您可以使用该清单进行可重新预测的构建。 您应该从 ",-1)),e(t,{href:"https://source.android.com/docs/core/architecture/kernel/gki-release-builds",target:"_blank",rel:"noreferrer"},{default:n(()=>[...s[3]||(s[3]=[a("通用内核映像 (GKI) 发布构建",-1)])]),_:1}),s[6]||(s[6]=a(" 下载清单文件",-1))]),s[23]||(s[23]=i("h3",{id:"构建",tabindex:"-1"},[a("构建 "),i("a",{class:"header-anchor",href:"#构建","aria-label":"Permalink to “构建”"},"​")],-1)),i("p",null,[s[8]||(s[8]=a("请先查看 ",-1)),e(t,{href:"https://source.android.com/docs/setup/build/building-kernels",target:"_blank",rel:"noreferrer"},{default:n(()=>[...s[7]||(s[7]=[a("官方文档",-1)])]),_:1}),s[9]||(s[9]=a("。",-1))]),s[24]||(s[24]=d(`<p>例如，我们需要构建 aarch64 内核镜像：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">thin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BUILD_CONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">common/build.config.gki.aarch64</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> build/build.sh</span></span></code></pre></div><p>不要忘记添加 <code>LTO=thin</code>, 否则，如果您的计算机内存小于 24GB，构建可能会失败.</p><p>从 Android 13 开始，内核由 <code>bazel</code> 构建:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tools/bazel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config=fast</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> //common:kernel_aarch64_dist</span></span></code></pre></div><h2 id="使用-resukisu-构建内核" tabindex="-1">使用 ReSukiSU 构建内核 <a class="header-anchor" href="#使用-resukisu-构建内核" aria-label="Permalink to “使用 ReSukiSU 构建内核”">​</a></h2><p>把 ReSukiSU 添加到你的内核源码树，在内核的根目录执行以下命令：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -LSs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://raw.githubusercontent.com/ReSukiSU/ReSukiSU/main/kernel/setup.sh&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span></span></code></pre></div><h3 id="手动钩子" tabindex="-1">手动钩子 <a class="header-anchor" href="#手动钩子" aria-label="Permalink to “手动钩子”">​</a></h3><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>请注意，某些设备的 defconfig 文件可能在 <code>arch/arm64/configs/设备代号_defconfig</code> 或位于 <code>arch/arm64/configs/vendor/设备代号_defconfig</code>。在您的 defconfig 文件中，将 <code>CONFIG_KSU</code> 设置为 <code>y</code> 以启用 ReSukiSU，或设置为 <code>n</code> 以禁用。比如在某个 defconfig 中： <code>arch/arm64/configs/...</code></p><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+# ReSukiSU</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+CONFIG_KSU=y</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+CONFIG_KSU_MANUAL_HOOK=y</span></span></code></pre></div></div>`,10)),i("p",null,[s[11]||(s[11]=a("然后，将 ",-1)),e(t,{href:"./manual-integrate.html"},{default:n(()=>[...s[10]||(s[10]=[a("ReSukiSU 调用添加到内核源代码",-1)])]),_:1}),s[12]||(s[12]=a(" 中，改完之后重新编译内核即可。",-1))]),s[25]||(s[25]=d(`<h3 id="susfs" tabindex="-1">SUSFS <a class="header-anchor" href="#susfs" aria-label="Permalink to “SUSFS”">​</a></h3><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>请注意，某些设备的 defconfig 文件可能在 <code>arch/arm64/configs/设备代号_defconfig</code> 或位于 <code>arch/arm64/configs/vendor/设备代号_defconfig</code>。在您的 defconfig 文件中，将 <code>CONFIG_KSU</code> 设置为 <code>y</code> 以启用 ReSukiSU，或设置为 <code>n</code> 以禁用。比如在某个 defconfig 中： <code>arch/arm64/configs/...</code></p><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+# ReSukiSU</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+CONFIG_KSU=y</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+CONFIG_KSU_SUSFS=y</span></span></code></pre></div></div>`,2)),i("p",null,[s[14]||(s[14]=a("然后，在",-1)),e(t,{href:"https://gitlab.com/simonpunk/susfs4ksu",target:"_blank",rel:"noreferrer"},{default:n(()=>[...s[13]||(s[13]=[a(" SUSFS 仓库",-1)])]),_:1}),s[15]||(s[15]=a("中",-1)),s[16]||(s[16]=i("strong",null,"根据你的内核版本选择分支",-1)),s[17]||(s[17]=a("并按照指导打",-1)),s[18]||(s[18]=i("strong",null,"内核侧",-1)),s[19]||(s[19]=a("补丁，改完之后重新编译内核即可。",-1))]),s[26]||(s[26]=i("div",{class:"warning custom-block"},[i("p",{class:"custom-block-title custom-block-title-default"},"WARNING"),i("p",null,"NonGKI 的分支处于弃置状态，如果需要使用 SUSFS, 请自行 backport 移植")],-1)),e(r)])}const E=k(g,[["render",c]]);export{C as __pageData,E as default};
