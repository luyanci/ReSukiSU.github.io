import{_ as h,I as l,o as k,c as p,j as s,a as e,J as a,w as n,ab as o}from"./chunks/framework.CEw9AoTv.js";const C=JSON.parse('{"title":"How to intregate ReSukiSU","description":"","frontmatter":{},"headers":[],"relativePath":"guide/build.md","filePath":"guide/build.md"}'),u={name:"guide/build.md"},g={class:"info custom-block"};function c(b,i,f,y,m,F){const r=l("CopyOrDownloadAsMarkdownButtons"),t=l("VPNolebaseInlineLinkPreview"),d=l("NolebaseGitChangelog");return k(),p("div",{"data-pagefind-body":!0,"data-pagefind-meta":"date:1771295867000"},[i[21]||(i[21]=s("div",{style:{display:"none"},hidden:"true","aria-hidden":"true"},"Are you an LLM? You can read better optimized documentation at /guide/build.md for this page in Markdown format",-1)),i[22]||(i[22]=s("h1",{id:"introduction",tabindex:"-1"},[e("How to intregate ReSukiSU "),s("a",{class:"header-anchor",href:"#introduction","aria-label":"Permalink to “How to intregate ReSukiSU”"},"​")],-1)),a(r),s("div",g,[i[2]||(i[2]=s("p",{class:"custom-block-title"},"Notes",-1)),s("p",null,[i[1]||(i[1]=e("This document modified from ",-1)),a(t,{href:"https://kernelsu.org",target:"_blank",rel:"noreferrer"},{default:n(()=>[...i[0]||(i[0]=[e("KernelSU Official Documentation",-1)])]),_:1})])]),i[23]||(i[23]=o(`<p>ReSukiSU can be integrated into non-GKI kernels and was <mark>backported to 4.9 and earlier</mark> versions.</p><p>Due to the fragmentation of non-GKI kernels, we don&#39;t have a universal way to build them; therefore, we cannot provide a non-GKI boot.img. However, you can build the kernel with ReSukiSU integrated on your own.</p><p>First, you should be able to build a bootable kernel from kernel source code. If the kernel isn&#39;t open source, then it is difficult to run ReSukiSU for your device.</p><p>If you&#39;re able to build a bootable kernel, you can add ReSukiSU into your kernel by following this guide.</p><h2 id="building-kernel" tabindex="-1">Building Kernel <a class="header-anchor" href="#building-kernel" aria-label="Permalink to “Building Kernel”">​</a></h2><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>This part is for GKI devices</p></div><h3 id="sync-the-kernel-source-code" tabindex="-1">Sync the kernel source code <a class="header-anchor" href="#sync-the-kernel-source-code" aria-label="Permalink to “Sync the kernel source code”">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://android.googlesource.com/kernel/manifest</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">kernel_manifest.xm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">l</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .repo/manifests</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> manifest.xml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sync</span></span></code></pre></div>`,8)),s("p",null,[i[4]||(i[4]=e("The ",-1)),i[5]||(i[5]=s("code",null,"<kernel_manifest.xml>",-1)),i[6]||(i[6]=e(" file is a manifest that uniquely identifies a build, allowing you to make it reproducible. To do this, you should download the manifest file from ",-1)),a(t,{href:"https://source.android.com/docs/core/architecture/kernel/gki-release-builds",target:"_blank",rel:"noreferrer"},{default:n(()=>[...i[3]||(i[3]=[e("GKI release builds",-1)])]),_:1}),i[7]||(i[7]=e(".",-1))]),i[24]||(i[24]=s("h3",{id:"build",tabindex:"-1"},[e("Build "),s("a",{class:"header-anchor",href:"#build","aria-label":"Permalink to “Build”"},"​")],-1)),s("p",null,[i[9]||(i[9]=e("Please check the ",-1)),a(t,{href:"https://source.android.com/docs/setup/build/building-kernels",target:"_blank",rel:"noreferrer"},{default:n(()=>[...i[8]||(i[8]=[e("Building kernels",-1)])]),_:1}),i[10]||(i[10]=e(" first.",-1))]),i[25]||(i[25]=o(`<p>For example, to build an <code>aarch64</code> kernel image:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LTO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">thin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BUILD_CONFIG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">common/build.config.gki.aarch64</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> build/build.sh</span></span></code></pre></div><p>Don&#39;t forget to add the <code>LTO=thin</code> flag; otherwise, the build may fail if your computer has less than 24 GB of memory.</p><p>Starting from Android 13, the kernel is built by <code>bazel</code>:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tools/bazel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config=fast</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> //common:kernel_aarch64_dist</span></span></code></pre></div><h2 id="build-kernel-with-resukisu" tabindex="-1">Build kernel with ReSukiSU <a class="header-anchor" href="#build-kernel-with-resukisu" aria-label="Permalink to “Build kernel with ReSukiSU”">​</a></h2><p>First, add ReSukiSU to your kernel source tree:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -LSs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://raw.githubusercontent.com/ReSukiSU/ReSukiSU/main/kernel/setup.sh&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span></span></code></pre></div><h3 id="manual-hooks" tabindex="-1">Manual hooks <a class="header-anchor" href="#manual-hooks" aria-label="Permalink to “Manual hooks”">​</a></h3><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>Keep in mind that, on some devices, your defconfig may be located at <code>arch/arm64/configs</code> or in other cases, it may be at <code>arch/arm64/configs/vendor/your_defconfig</code>. Regardless of the defconfig you&#39;re using, make sure to enable <code>CONFIG_KSU</code> with <code>y</code> to enable or <code>n</code> to disable it. For example, if you choose to enable it, your defconfig should contain the following string：</p><p><code>arch/arm64/configs/...</code></p><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+# ReSukiSU</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+CONFIG_KSU=y</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+CONFIG_KSU_MANUAL_HOOK=y</span></span></code></pre></div></div>`,10)),s("p",null,[i[12]||(i[12]=e("Then,add ",-1)),a(t,{href:"./manual-integrate.html"},{default:n(()=>[...i[11]||(i[11]=[e("ReSukiSU's hooks",-1)])]),_:1}),i[13]||(i[13]=e(" into your kernel, and build your kernel again, and ReSukiSU should work correctly.",-1))]),i[26]||(i[26]=o(`<h3 id="susfs" tabindex="-1">SUSFS <a class="header-anchor" href="#susfs" aria-label="Permalink to “SUSFS”">​</a></h3><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>Keep in mind that, on some devices, your defconfig may be located at <code>arch/arm64/configs</code> or in other cases, it may be at <code>arch/arm64/configs/vendor/your_defconfig</code>. Regardless of the defconfig you&#39;re using, make sure to enable <code>CONFIG_KSU</code> with <code>y</code> to enable or <code>n</code> to disable it. For example, if you choose to enable it, your defconfig should contain the following string：</p><p><code>arch/arm64/configs/...</code></p><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+# ReSukiSU</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+CONFIG_KSU=y</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+CONFIG_KSU_SUSFS=y</span></span></code></pre></div></div>`,2)),s("p",null,[i[15]||(i[15]=e("Then, in the ",-1)),a(t,{href:"https://gitlab.com/simonpunk/susfs4ksu",target:"_blank",rel:"noreferrer"},{default:n(()=>[...i[14]||(i[14]=[e("SUSFS repository",-1)])]),_:1}),i[16]||(i[16]=e(", ",-1)),i[17]||(i[17]=s("strong",null,"choose the branch that matches your kernel version",-1)),i[18]||(i[18]=e(" and apply the ",-1)),i[19]||(i[19]=s("strong",null,"kernel-side patches",-1)),i[20]||(i[20]=e(" as instructed; after making the changes, rebuild the kernel.",-1))]),i[27]||(i[27]=s("div",{class:"warning custom-block"},[s("p",{class:"custom-block-title custom-block-title-default"},"WARNING"),s("p",null,"The NonGKI branches are deprecated. If you need to use SUSFS, please backport it yourself.")],-1)),a(d)])}const v=h(u,[["render",c]]);export{C as __pageData,v as default};
